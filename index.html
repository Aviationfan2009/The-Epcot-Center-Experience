<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Zone Tracker</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f2f5; }
        .container { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; }
        
        #zone-status { 
            font-size: 1.5rem; font-weight: bold; padding: 15px; border-radius: 8px; margin: 15px 0;
            background: #e9ecef; color: #6c757d; 
        }
        .inside { background: #d4edda !important; color: #155724 !important; border: 2px solid #c3e6cb; }
        
        #map-container {
            position: fixed; bottom: 20px; right: 20px; width: 250px; height: 250px;
            border: 4px solid white; border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            overflow: hidden; display: none;
        }
        iframe { width: 100%; height: 100%; border: none; }
        button { padding: 12px 24px; font-size: 1rem; cursor: pointer; border-radius: 8px; border: none; background: #007bff; color: white; }
    </style>
</head>
<body>

<div class="container">
    <h2>Zone Monitor</h2>
    <div id="zone-status">Outside All Zones</div>
    <div id="coords-display">Waiting for start...</div>
    <br>
    <button id="action-btn" onclick="startTracking()">Start Tracking</button>
</div>

<div id="map-container">
    <iframe id="map-frame" src=""></iframe>
</div>

<script>
    // --- CONFIGURE YOUR ZONES HERE ---
    // A zone is a "Polygon" (a list of lat/lon points). 
    // IMPORTANT: The first and last point should be the same to "close" the shape.
    const ZONES = [
        {
            name: "Home Base",
            points: [
                { lat: 36.444, lng: -75.999 },
                { lat: 36.445, lng: -75.999 },
                { lat: 36.445, lng: -75.998 },
                { lat: 36.444, lng: -75.998 },
                { lat: 36.444, lng: -75.999 } // Closing point
            ]
        },
        {
            name: "The Warehouse",
            points: [
                { lat: 40.712, lng: -74.006 },
                { lat: 40.713, lng: -74.006 },
                { lat: 40.713, lng: -74.005 },
                { lat: 40.712, lng: -74.005 },
                { lat: 40.712, lng: -74.006 }
            ]
        }
    ];

    let watchID = null;

    // Ray-casting algorithm to check if a point is inside a polygon
    function isInside(point, vs) {
        let x = point.lat, y = point.lng;
        let inside = false;
        for (let i = 0, j = vs.length - 1; i < vs.length; j = i++) {
            let xi = vs[i].lat, yi = vs[i].lng;
            let xj = vs[j].lat, yj = vs[j].lng;
            let intersect = ((yi > y) != (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
            if (intersect) inside = !inside;
        }
        return inside;
    }

    function startTracking() {
        if (!navigator.geolocation) return alert("GPS not supported");

        watchID = navigator.geolocation.watchPosition((position) => {
            const userLat = position.coords.latitude;
            const userLng = position.coords.longitude;
            
            // 1. Update text display
            document.getElementById("coords-display").innerText = `Lat: ${userLat.toFixed(5)}, Lng: ${userLng.toFixed(5)}`;

            // 2. Check Zones
            let currentZoneName = "Outside All Zones";
            let foundInside = false;

            ZONES.forEach(zone => {
                if (isInside({lat: userLat, lng: userLng}, zone.points)) {
                    currentZoneName = `Inside: ${zone.name}`;
                    foundInside = true;
                }
            });

            const statusDiv = document.getElementById("zone-status");
            statusDiv.innerText = currentZoneName;
            statusDiv.className = foundInside ? "inside" : "";

            // 3. Update Map
            document.getElementById("map-container").style.display = "block";
            document.getElementById("map-frame").src = `https://maps.google.com{userLat},${userLng}&z=18&output=embed`;

        }, (err) => console.error(err), { enableHighAccuracy: true });
    }
</script>
</body>
</html>
